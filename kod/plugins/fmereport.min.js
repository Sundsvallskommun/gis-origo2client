var Fmereport;(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};(()=>{e.d(t,{default:()=>o});const o=function({reportNames:e=["Report name 1"],reportUrls:t=["FME Flow URL with token parameter"],reportIcon:o="#fa-info-circle"}={}){const n=Origo.ui.dom,r=new Origo.ol.source.Vector,i=new Origo.ol.layer.Vector({group:"none",name:"reportLayer",title:"reportLayer",source:r,zIndex:8,styleName:"origoStylefunction"});let d,a,l,c,m,s,g,u,p,h,f,y,I,E,v,w,B,L,x,b,N,O,C=null,k=[];const T=e=>{origo.api().getFeatureinfo().clear();for(const t of N.category)for(const o of t.item)o.id!=e.srcElement.id&&o.id!=e.srcElement.parentNode.parentNode.id||!t.layerName||(origo.api().getLayer(t.layerName).setVisible(!0),c=JSON.parse(o.geometry),l=t.layerName,B.once("rendercomplete",M),B.getView().setCenter(c))},M=()=>{if(!c)return;a=B.getPixelFromCoordinate(c);let e={clusterFeatureinfoLevel:2,coordinate:c,hitTolerance:5,map:B,pixel:a},t={coordinate:c,map:B,pixel:a};const o=Origo.getFeatureInfo.getFeaturesAtPixel(e,w);Origo.getFeatureInfo.getFeaturesFromRemote(t,w).then((e=>{const t=(e||[]).concat(o).filter((e=>e.selectionGroup==l));t.length>0&&(origo.api().getFeatureinfo().render(t,origo.getConfig().featureinfoOptions.infowindow||"overlay",c),B.getView().fit(t[0].feature.getGeometry().getExtent()),c="",l="")}))},F=e=>{const t=document.createElement("div");t.className="report-container";const o=document.createElement("div");o.className="category-header",o.textContent=e.name,t.appendChild(o);for(const o of e.item){t.appendChild(A(o));const e=P(o),n=H(o);t.appendChild(e),t.appendChild(n)}return t},P=e=>{const t=document.createElement("a");if(t.className="report-button",e.link){const o=R(e.icon);t.href=e.link,t.target="_blank",t.rel="noopener noreferrer",t.innerHTML=o.render()}return t},H=e=>{const t=document.createElement("div");if(t.className="report-button",e.geometry){const o=R();e.id=o.getId(),t.innerHTML=o.render()}return t},R=e=>Origo.ui.Button({cls:"o-fmereport padding-small icon-smaller round light box-shadow tooltip",tagName:"div",icon:e||"#fa-map-marker"}),A=e=>{const t=document.createElement("div");t.className="report-item-wrapper";const o=document.createElement("div");o.className="report-item-header",o.textContent=e.title,t.appendChild(o);const n=document.createElement("div");return n.className="report-item",n.innerHTML=e.description.replace(/\n/g,"<br>"),t.appendChild(n),t},G=e=>{"Point"!==e.feature.getGeometry().getType()&&(e=>{const t=e.feature.getGeometry().getType(),o=[];"Point"!==t&&(B.getInteractions().forEach((e=>{e instanceof Origo.ol.interaction.DoubleClickZoom&&o.push(e)})),o.length>0&&B.removeInteraction(o[0]))})(e)},V=e=>{const t={tool:"ReportGeometry",active:e};setTimeout((()=>{w.dispatch("toggleClickInteraction",t)}),100)},j=e=>{const t={Polygon:b.getId(),Point:E.getId()};let o=t[e];O&&(B.removeInteraction(O),O=null),C&&(document.getElementById(t[C]).classList.remove("active","hover"),V(!1)),C===e?(D(),C=null):(C=e,D(),document.getElementById(o).classList.add("active"),V(!0),O=new Origo.ol.interaction.Draw({source:r,type:e}),B.addInteraction(O),O.setActive(!0),O.on("drawstart",G,this),O.on("drawend",(t=>{x=t.feature.getGeometry().clone();let n=x.flatCoordinates;if(k=[],"Polygon"==e)for(let e=0;e<n.length-2;e++)k.push(n[e]+":"+n[e+1]),e++;else k.push(n[0]+":"+n[1]);document.getElementById(o).classList.remove("active"),setTimeout((()=>{(()=>{const e=[];B.getInteractions().forEach((t=>{t instanceof Origo.ol.interaction.DoubleClickZoom&&e.push(t)})),e.length<1&&B.addInteraction(new Origo.ol.interaction.DoubleClickZoom)})()}),100),V(!1),B.removeInteraction(O),O.setActive(!1),C=null})))},z=()=>{document.getElementById(f.getId()).classList.add("o-hidden"),document.getElementById(s.getId()).classList.remove("active"),document.getElementById(s.getId()).classList.add("tooltip"),document.getElementById(g.getId()).classList.add("o-hidden"),B&&O&&(B.removeInteraction(O),O.setActive(!1)),D()},D=()=>{r&&r.clear(),x="",k=[]};return Origo.ui.Component({name:"fmereport",onInit(){g=Origo.ui.Element({tagName:"div",cls:"flex column control box bg-white overflow-hidden o-hidden filter-box",style:{left:"4rem",top:"1rem",padding:"0.5rem",width:"15rem","z-index":"-1"}}),p=Origo.ui.Element({tagName:"select",cls:"width-100",style:{padding:"0.2rem","font-size":"0.8rem"},innerHTML:'<option value="">Välj rapport...</option>'}),h=Origo.ui.Element({tagName:"p",cls:"text-smaller",innerHTML:"Rapportverktyg:"}),I=Origo.ui.Button({cls:"small round margin-top-smaller margin-bottom-auto margin-right-small icon-smaller grey-lightest",icon:"#ic_close_24px",style:{float:"right"}}),b=Origo.ui.Button({cls:"grow light text-smaller box-shadow padding-left-large",text:"Polygon"}),E=Origo.ui.Button({cls:"grow light text-smaller box-shadow padding-left-large",text:"Rita en punkt"}),L=Origo.ui.Button({cls:"light rounded-large border text-smaller padding-right-large o-tooltip",text:"Skicka rapport",style:{padding:"0.4rem",width:"10rem","background-color":"#ebebeb"}}),u=Origo.ui.Element({tagName:"div",components:[h,b,E,p,L]}),y=Origo.ui.Element({tagName:"div",components:[I]}),f=Origo.ui.Element({tagName:"div",cls:"flex column control box bg-white overflow-hidden o-hidden filter-box draggable",style:{left:"4rem",top:"1rem",padding:"0.5rem","max-width":"30rem","overflow-x":"auto","overflow-y":"auto","z-index":"-1"}}),s=Origo.ui.Button({cls:"o-fmereport padding-small icon-smaller round light box-shadow tooltip",click(){D(),document.getElementById(s.getId()).classList.contains("tooltip")?(document.getElementById(s.getId()).classList.add("active"),document.getElementById(s.getId()).classList.remove("tooltip"),document.getElementById(g.getId()).classList.remove("o-hidden")):z()},icon:o,tooltipText:"Ta fram en rapport",tooltipPlacement:"east"})},onAdd(o){w=o.target,v||(v=`${w.getMain().getMapTools().getId()}`),B=w.getMap(),B.addLayer(i),this.addComponents([s]),this.render(),(()=>{const o=document.getElementById(p.getId());e.forEach(((e,n)=>{const r=document.createElement("option");r.value=t[n],r.text=e,o.appendChild(r)}))})()},render(){document.getElementById(v).appendChild(n.html(s.render())),document.getElementById(w.getMain().getId()).appendChild(n.html(g.render())),document.getElementById(w.getMain().getId()).appendChild(n.html(f.render())),document.getElementById(g.getId()).appendChild(n.html(u.render())),document.getElementById(f.getId()).appendChild(n.html(y.render())),document.getElementById(L.getId()).addEventListener("click",(()=>(async()=>{if(0!==k.length)if(""!==document.getElementById(p.getId()).value){document.getElementById(g.getId()).classList.add("o-hidden"),document.body.style.cursor="wait";try{const e=await fetch(document.getElementById(p.getId()).value+"&PARAMETER="+k);if(!e.ok)throw new Error("Network response was not ok.");if(N=await e.json(),!(N&&N.category&&N.category.length>0))throw new Error("No data found within the area.");{for(const e of N.category)for(const t of e.item)t.id||(t.id=Math.random().toString(36).substr(2,9));d=(e=>{const t=document.createElement("div"),o=Origo.ui.Element({tagName:"div",cls:"report-header",innerHTML:e.title});t.innerHTML=o.render();for(const o of e.category)t.appendChild(F(o));return t.innerHTML})(N),m=Origo.ui.Element({tagName:"div",innerHTML:d});let e=document.getElementById(f.getId()).getElementsByTagName("div");e.length>1&&document.getElementById(f.getId()).removeChild(e[1]),document.getElementById(f.getId()).appendChild(n.html(m.render()));for(const e of N.category)for(const t of e.item)t.id&&t.geometry&&document.getElementById(t.id).addEventListener("click",T);document.getElementById(f.getId()).classList.remove("o-hidden")}}catch(e){console.error("Error fetching content:",e),Origo.ui.Modal({title:e.message.includes("No data")?"Resultat":"Fel vid anrop",content:e.message.includes("No data")?"Ingen information hittades inom området":"Något gick fel vid anrop, prova igen eller kontakta systemadministratör",target:w.getId()}),z()}finally{document.body.style.cursor="default"}}else window.alert("Ingen rapport vald");else window.alert("Ingen geometri ritad")})())),document.getElementById(I.getId()).addEventListener("click",(()=>z())),document.getElementById(b.getId()).addEventListener("click",(()=>j("Polygon"))),document.getElementById(E.getId()).addEventListener("click",(()=>j("Point"))),this.dispatch("render")}})}})(),Fmereport=t.default})();