var Origofilteretuna;(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};(()=>{e.d(t,{default:()=>a});const n=Origo;var l=e.n(n);const o=function(e){let t=e;return"object"==typeof e&&null!==e&&(t="function"==typeof e.getUrl?e.getUrl():e.getUrls()[0]),t.startsWith("http")||(t=window.location.origin.concat(t)),t},r=async function(e,t){const n=new URL(o(t).split("?")[0]);let l;const r=e.getImage();r.onload=()=>{URL.revokeObjectURL(l)};const a={method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded"},body:t.split("?")[1]},i=await fetch(n,a);if(i.ok){const e=await i.blob();l=URL.createObjectURL(e),r.src=l}},a=function(e={}){let t,n,a,i,d,s,c,m,u,g,p,y,f,h,I,E,v,L,b,w,x,B,S,T,N,C,F,$,k,q,O,M,P,R,j,A,W,H,_,U,V,z,D,Q,G,J,K,X,Y,Z,ee,te,ne,le={filters:[]},oe=!1,re=!1,ae=0,ie="simple";const de="origofilteretuna",se=l().ui,ce=["WMS","WFS"],me=[" = "," <> "," < "," > "," <= "," >= "," like "," between "],ue=function(e,t){e.getImage().src=t},ge=function(e,t){e.getImage().src=t},pe=[],ye="hideButtonWhenEmbedded"in e&&e.hideButtonWhenEmbedded,fe=Object.prototype.hasOwnProperty.call(e,"excludedAttributes")?e.excludedAttributes:[],he=Object.prototype.hasOwnProperty.call(e,"excludedLayers")?e.excludedLayers:[],Ie=Object.prototype.hasOwnProperty.call(e,"optionBackgroundColor")?e.optionBackgroundColor:"#e1f2fe",Ee=Object.prototype.hasOwnProperty.call(e,"filterPrefix")?e.filterPrefix:"Filter - ",ve=Object.prototype.hasOwnProperty.call(e,"indicatorBackgroundColor")?e.indicatorBackgroundColor:"#ff0000",Le=Object.prototype.hasOwnProperty.call(e,"indicatorTextColor")?e.indicatorTextColor:"#ffffff",be=!Object.prototype.hasOwnProperty.call(e,"actLikeRadioButton")||e.actLikeRadioButton,we=Object.prototype.hasOwnProperty.call(e,"tooltipText")?e.tooltipText:"Filter",xe=Object.prototype.hasOwnProperty.call(e,"warningTooltipText")?e.warningTooltipText:"Attribut med Å, Ä, Ö eller mellanslag kan inte användas för filtrering",Be=Object.prototype.hasOwnProperty.call(e,"warningBackgroundColor")?e.warningBackgroundColor:"#fff700",Se=Object.prototype.hasOwnProperty.call(e,"warningTextColor")?e.warningTextColor:"#000000",Te=Object.prototype.hasOwnProperty.call(e,"warningText")?e.warningText:"OBS!",Ne=Object.prototype.hasOwnProperty.call(e,"geoserverUrl")?e.geoserverUrl:void 0,Ce=Object.prototype.hasOwnProperty.call(e,"wfsSharedFilterDelay")?e.wfsSharedFilterDelay:5;function Fe(){if(document.getElementsByClassName("o-search").length>0){!function(e,t){const n=e.getBoundingClientRect(),l=t.getBoundingClientRect();return!(n.right<l.left||n.left>l.right||n.bottom<l.top||n.top>l.bottom)}(document.getElementsByClassName("o-search")[0],document.getElementById(s.getId()))?window.innerWidth>ae&&(document.getElementById(d.getId()).style.top="1rem"):(document.getElementById(d.getId()).style.top="4rem",ae=window.innerWidth)}}function $e(e){oe=e}function ke(){return t.getLayers().filter((e=>ce.includes(e.get("type"))&&!he.includes(e.get("name"))&&e.get("visible")&&!e.get("ArcGIS")))}function qe(e){let t="";if("WMS"===e.get("type")){const n=e.getSource().getParams();n.CQL_FILTER&&(t=n.CQL_FILTER)}else"WFS"===e.get("type")&&e.get("cqlFilter")&&(t=e.get("cqlFilter"));return t}function Oe(e){if(e&&!0===ye)document.getElementById(J.getId()).classList.add("o-hidden");else{const e=t.getLayers().filter((e=>""!==qe(e))).length;document.getElementById(K.getId()).innerHTML=e,document.getElementById("myFilterCount").innerHTML=e,e>0?document.getElementById(J.getId()).classList.remove("o-hidden"):document.getElementById(J.getId()).classList.add("o-hidden")}}function Me(e){let t=!1;return["å","ä","ö","Å","Ä","Ö"].forEach((n=>{e.includes(n)&&(t=!0)})),t}function Pe(e){return t.getSource(e.get("sourceName")).url.slice(0,-3)}async function Re(e){let t=[];if(ne){const n=await ne.getFtlMap(e);n&&n.length>0&&(t=n)}const n=await async function(e){try{const t=[`${Pe(e)}`,"wfs?version=1.3.0&request=describeFeatureType&outputFormat=application/json&service=WFS",`&typeName=${e.get("name").split("__")[0]}`].join(""),n=await fetch(t);return await n.json()}catch(e){return null}}(e);if(!n)return t;const l=n.featureTypes[0].properties,o=[];return l.forEach((e=>{const n=e;if(t.length>0){const e=t.find((e=>e.name===n.name));e&&(n.ftlValue=e.ftlValue,t=t.filter((t=>t.name!==e.name)))}o.push(n)})),t.length>0&&o.push(...t),o.filter((e=>!fe.includes(e.name)))}async function je(e,t,n,l){const o=document.getElementsByClassName("attributeRow")[0],r=l?o:o.cloneNode(!0);if(e){Z||(Z=await Re(X));const t=Z.findIndex((t=>t.name===e));r.querySelector(`#${S.getId()}`).selectedIndex=t}if(t){const e=me.findIndex((e=>e===t));r.querySelector(`#${T.getId()}`).selectedIndex=e}r.querySelector("input").value=n||"",l||(r.querySelector("button").classList.remove("o-hidden"),r.querySelector("button").addEventListener("click",(()=>{r.remove()})));const a=document.getElementsByClassName("attributeRow").length-1;document.getElementsByClassName("attributeRow")[a].after(r)}function Ae(){document.getElementsByClassName("attributeRow")[0].querySelector(`#${S.getId()}`).selectedIndex=0,document.getElementsByClassName("attributeRow")[0].querySelector(`#${T.getId()}`).selectedIndex=0,document.getElementsByClassName("attributeRow")[0].querySelector("input").value="";const e=document.getElementsByClassName("attributeRow").length;for(let t=1;t<e;t+=1)document.getElementsByClassName("attributeRow")[1].remove()}function We(e){if(""!==e){const t=e.includes(" OR "),n=e.includes(" AND ");if(t&&n)return;const l=t?"OR":"AND",o=e.split(` ${l} `);document.getElementById(N.getId()).selectedIndex=n?1:0,Ae(),o.forEach(((e,t)=>{const n=e.split(" "),l=n[0],o=n[1],r=[];for(let e=2;e<n.length;e+=1)r.push(n[e].replaceAll("'",""));je(l,` ${o} `,r.join(" "),0===t)}))}}function He(){document.getElementById(D.getId()).innerHTML="",le.filters.forEach((e=>{const n=document.createElement("li");n.id=e.layerName,n.classList="rounded border text-smaller padding-small margin-top-small relative o-tooltip",n.innerHTML=`<p style="overflow-wrap: break-word; width: 18rem"><span class="text-weight-bold">Lager: </span>${e.title}</p>\n<p style="overflow-wrap: break-word;"><span class="text-weight-bold">Filter: </span>${e.cqlFilter}</p>\n${E.render()}${v.render()}${L.render()}`;const l=t.getLayer(e.layerName);l&&l.get("visible")?n.querySelector(".display-filter").classList.add("o-hidden"):(n.querySelector(".edit-filter").classList.add("disabled"),n.querySelector(".display-filter").classList.remove("o-hidden")),document.getElementById(D.getId()).append(n)}))}function _e(e){const t=document.getElementById(B.getId()),n=t.options[e].text;t.options[e].text=n.replace(Ee,""),t.options[e].style=""}function Ue(e){const t=document.getElementById(B.getId());Array.from(t.options).forEach(((n,l)=>{if(n.value===e){_e(l);const e=n.text;t.options[l].text=`${Ee}${e}`,t.options[l].style=`background-color: ${Ie}`}}))}async function Ve({layer:e,cqlFilter:t,ogcFilter:n}){e.set("cqlFilter",t);const l=await async function(e,t){const n=[];if(t){const e=t.split(" "),l=Me(t);e.forEach(((t,o)=>{let r=!1;me.forEach((t=>{e[o+1]===t.trim()&&(r=!0)})),l&&r?n.push(`'${t}'`):n.push(t)}))}const l=Pe(e),o={service:"WFS",version:"1.1.1",request:"GetFeature",outputFormat:"application/json",typeNames:e.get("name").split("__")[0]};t&&(o.FILTER=n.join(" "));const r={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",body:new URLSearchParams(o).toString().replace(/\+/g,"%20")},a=await fetch(`${l}wfs?`,r);return await a.json()}(e,n),o=e.getSource();o.clear(!0),o.addFeatures(o.getFormat().readFeatures(l))}function ze(e,t){Ue(e),Oe(t)}function De(e,t){e.imageLoadFunction?t?e.setImageLoadFunction(ue):e.setImageLoadFunction(r):e.tileLoadFunction&&(t?e.setTileLoadFunction(ge):e.setTileLoadFunction(r))}function Qe(e){const t={WMSType:""};return e.getImageLoadFunction?(t.WMSType="image",t.funct=e.getImageLoadFunction(),t):(t.WMSType="tile",t.funct=e.getTileLoadFunction(),t)}function Ge(e){const n=t.getMapSource(),l=e.get("sourceName");if(n[l]?.requestMethod&&"post"===n[l].requestMethod.toLowerCase())return!0;if(e.get("requestMethod")&&"post"===e.get("requestMethod").toLowerCase())return!0;const o=Qe(e.getSource());return!(o.funct===r||!o.funct.toString().includes("post")&&!o.funct.toString().includes("POST"))}function Je(e,t){const n=Ge(t);Qe(e).funct===r||n||De(e,!1)}function Ke(e){e?le.filters.forEach(((t,n)=>{t.layerName===e&&le.filters.splice(n,1)})):le={filters:[]}}const Xe={"=":"PropertyIsEqualTo","<>":"PropertyIsNotEqualTo","<":"PropertyIsLessThan","<=":"PropertyIsLessThanOrEqualTo",">":"PropertyIsGreaterThan",">=":"PropertyIsGreaterThanOrEqualTo",like:"PropertyIsLike",between:"PropertyIsBetween"};function Ye(e){return Xe[e.trim()]}function Ze(e){const n=e||X.get("name");if(!pe.some((e=>e.get("name")===n)))return;const l=t.getLayer(e)||X;if(document.getElementById(Q.getId()).value="","WMS"===l.get("type")){const e=l.getSource();e.updateParams({layers:l.get("id"),CQL_FILTER:void 0}),Ge(l)||De(e,!0)}else"WFS"===l.get("type")&&Ve({layer:l});const o=document.getElementById(B.getId()),r=o.querySelector(`option[value="${e}"]`),a=e&&r?r.index:o.selectedIndex;pe.splice(pe.indexOf(l),1),_e(a),Ae(),Ke(l.get("name")),Oe()}function et(){Array.from(document.getElementsByClassName("attributeSelect")).forEach((e=>{for(;e.firstChild;)e.removeChild(e.firstChild);te=!1,Z.forEach((t=>{const n=t.name,l=document.createElement("option");l.text=t.ftlValue?t.ftlValue:n,l.value=n,(Me(n)||n.includes(" "))&&(l.disabled=!0,te=!0),e.appendChild(l)}))}))}function tt(){const e=document.getElementById(B.getId());for(;e.firstChild;)e.removeChild(e.firstChild);const n=document.createElement("option");n.value="",n.text="Välj...",e.appendChild(n),Y.forEach((t=>{const n=document.createElement("option"),l=qe(t);n.value=t.get("name"),n.text=`${""!==l?Ee:""}${t.get("title")}`,n.style=""!==l?`background-color: ${Ie}`:"",e.appendChild(n)})),Array.from(document.getElementsByClassName("operatorSelect")).forEach((e=>{for(;e.firstChild;)e.removeChild(e.firstChild);me.forEach((t=>{const n=document.createElement("option");n.text=t,n.value=t,e.appendChild(n)}))})),X=t.getLayer(e.value),re||(e.addEventListener("change",(async e=>async function(e){if(""===e.target.value)return void document.getElementById(_.getId()).classList.add("o-hidden");if(X=t.getLayer(e.target.value),Z=await Re(X),Z.length<=0)return void document.getElementById(_.getId()).classList.add("o-hidden");et(),Ae();const n=qe(X);if(document.getElementById(Q.getId()).value=n,""!==n)We(n);else{document.getElementById(N.getId()).selectedIndex=0;const e=document.getElementsByClassName("attributeRow")[0];e.querySelector("input").value="",e.querySelector(`#${T.getId()}`).value=me[0]}te?document.getElementById(z.getId()).classList.remove("o-hidden"):document.getElementById(z.getId()).classList.add("o-hidden"),document.getElementById(_.getId()).classList.remove("o-hidden")}(e))),re=!0)}function nt(e){ie===e&&"myfilter"!==e||(ie=e,"simple"===ie?(document.getElementById(c.getId()).classList.add("active"),document.getElementById(m.getId()).classList.remove("active"),document.getElementById(u.getId()).classList.remove("active"),document.getElementById(W.getId()).classList.remove("o-hidden"),document.getElementById(H.getId()).classList.add("o-hidden"),document.getElementById(U.getId()).classList.remove("o-hidden"),document.getElementById(V.getId()).classList.add("o-hidden")):"advanced"===ie?(document.getElementById(c.getId()).classList.remove("active"),document.getElementById(m.getId()).classList.add("active"),document.getElementById(u.getId()).classList.remove("active"),document.getElementById(W.getId()).classList.add("o-hidden"),document.getElementById(H.getId()).classList.remove("o-hidden"),document.getElementById(U.getId()).classList.remove("o-hidden"),document.getElementById(V.getId()).classList.add("o-hidden")):"myfilter"===ie&&(document.getElementById(c.getId()).classList.remove("active"),document.getElementById(m.getId()).classList.remove("active"),document.getElementById(u.getId()).classList.add("active"),document.getElementById(U.getId()).classList.add("o-hidden"),document.getElementById(V.getId()).classList.remove("o-hidden"),He(),Array.from(document.getElementsByClassName("remove-filter")).forEach((e=>{e.addEventListener("click",(()=>{Ze(e.parentElement.id),He(),nt("myfilter")}))})),Array.from(document.getElementsByClassName("edit-filter")).forEach((e=>{e.addEventListener("click",(()=>{if(!e.classList.contains("disabled")){const n=e.parentElement.id,l=t.getLayer(n),o=document.getElementById(B.getId());o.selectedIndex=o.querySelector(`option[value="${n}"]`).index,o.dispatchEvent(new Event("change"));const r=qe(l),a=r.includes(" OR "),i=r.includes(" AND ");nt(a&&i?"advanced":"simple")}}))})),Array.from(document.getElementsByClassName("display-filter")).forEach((e=>{e.addEventListener("click",(()=>{const n=e.parentElement.id;t.getLayer(n).set("visible",!0),e.parentElement.querySelector(".edit-filter").classList.remove("disabled"),e.parentElement.querySelector(".display-filter").classList.add("o-hidden")}))}))),!X)||We(qe(X))}function lt(){document.getElementById(i.getId()).classList.add("active"),document.getElementById(i.getId()).classList.remove("tooltip"),document.getElementById(d.getId()).classList.remove("o-hidden"),be&&$e(!0)}function ot(){document.getElementById(i.getId()).classList.remove("active"),document.getElementById(i.getId()).classList.add("tooltip"),document.getElementById(d.getId()).classList.add("o-hidden"),be&&$e(!1)}function rt(e){e[de]=le}async function at(){if(Y=ke(),tt(),Ae(),Y.length>0&&X){Z=await Re(X),et();const e=qe(X);""!==e&&(document.getElementById(Q.getId()).value=e,We(e))}else document.getElementById(_.getId()).classList.add("o-hidden");He(),nt(ie)}function it(){t.getLayers().forEach((e=>{e.get("changeListener")||(e.set("changeListener",!0),e.on("change:visible",(async()=>{await at()})))}))}return l().ui.Component({name:"origofilteretuna",onInit(){K=l().ui.Element({tagName:"span",style:{color:`${Le}`,position:"absolute",left:"5px",top:"0px","font-size":"0.7rem"},innerHTML:"0"}),J=l().ui.Element({tagName:"div",cls:"padding-small margin-bottom-smaller round light box-shadow o-hidden",style:{width:"10px",height:"10px",bottom:"-6px",position:"absolute",right:"0px","background-color":`${ve}`,"z-index":1},components:[K]}),a=l().ui.Element({tagName:"div",cls:"flex column",style:{position:"relative"},components:[J]}),i=l().ui.Button({cls:"o-filteretuna padding-small margin-bottom-smaller icon-smaller round light box-shadow tooltip",click(){!function(){if(be){const e={name:"filter",active:!oe};t.dispatch("toggleClickInteraction",e)}else document.getElementById(i.getId()).classList.contains("tooltip")?(lt(),Fe()):ot()}()},icon:"#ic_filter_24px",tooltipText:`${we}`,tooltipPlacement:"east"}),c=l().ui.Button({cls:"grow light text-smaller padding-left-large active",text:"Enkel",style:{width:"1rem"},state:"simple"===ie?"active":"initial"}),m=l().ui.Button({cls:"grow light text-smaller padding-right-large",text:"Avancerad",style:{width:"1rem"},state:"advanced"===ie?"active":"initial"}),u=l().ui.Button({cls:"grow light text-smaller padding-right-large",text:'Mina filter (<span id="myFilterCount">0</span>)',style:{width:"1rem"},state:"myfilter"===ie?"active":"initial"}),b=l().ui.ToggleGroup({cls:"flex rounded bg-inverted border",components:[c,m,u],style:{display:"flex"}}),d=l().ui.Element({tagName:"div",cls:"flex column control box bg-white overflow-hidden o-hidden filter-box",style:{left:"4rem",top:"1rem",padding:"0.5rem",width:"25rem","z-index":"-1"}}),B=l().ui.Element({tagName:"select",cls:"width-100",style:{padding:"0.2rem","font-size":"0.8rem"},innerHTML:'<option value="">Välj...</option>'}),S=l().ui.Element({tagName:"select",cls:"attributeSelect",style:{padding:"0.2rem",width:"8rem","font-size":"0.8rem"}}),T=l().ui.Element({tagName:"select",cls:"operatorSelect",style:{padding:"0.2rem",width:"5rem","font-size":"0.8rem","margin-left":"0.4rem"}}),N=l().ui.Element({tagName:"select",style:{padding:"0.2rem","font-size":"0.7rem"},innerHTML:'<option value="OR">något</option><option value="AND">alla</option>'}),w=l().ui.Element({tagName:"div",style:{height:"1px","margin-top":"0.5rem","margin-bottom":"0.5rem","background-color":"#e8e8e8"}}),x=l().ui.Element({tagName:"div",style:{height:"1px","margin-top":"0.5rem","margin-bottom":"0.5rem","background-color":"#e8e8e8"}}),g=l().ui.Button({cls:"light rounded-large border text-smaller padding-right-large o-tooltip",style:{float:"left",padding:"0.4rem","background-color":"#ebebeb"},text:"Filtrera"}),p=l().ui.Button({cls:"light rounded-large border text-smaller padding-right-large o-tooltip",style:{float:"right",padding:"0.4rem","background-color":"#ebebeb"},text:"Rensa allt"}),y=l().ui.Button({cls:"light rounded-large border text-smaller padding-right-large o-tooltip",style:{float:"right",padding:"0.4rem","background-color":"#ebebeb"},text:"Rensa"}),G=l().ui.Input({cls:"placeholder-text-smaller smaller",value:"",placeholderText:"...",style:{height:"26px",padding:"0.3rem",width:"9rem",position:"absolute","margin-left":"0.4rem"}}),h=l().ui.Element({tagName:"span",style:{position:"absolute",top:"-4px",left:"2px"},innerHTML:"&times;"}),f=l().ui.Element({tagName:"button",cls:"light rounded-large border text-smaller padding-right-large o-tooltip removeAttributeButton o-hidden",style:{float:"right",padding:"0.1rem",height:"16px",width:"16px",position:"relative",top:"4px","margin-top":"2px","background-color":"#ffa6a6"},components:[h]}),C=l().ui.Element({tagName:"div",cls:"attributeRow",components:[S,T,G,f]}),F=l().ui.Element({tagName:"p",cls:"text-smaller",style:{width:"8.6rem","padding-left":"4px"},innerHTML:"Attribut"}),$=l().ui.Element({tagName:"p",cls:"text-smaller",style:{width:"5.4rem"},innerHTML:"Operator"}),O=l().ui.Element({tagName:"p",cls:"text-smaller",innerHTML:"Värde"}),R=l().ui.Element({tagName:"div",cls:"flex",components:[F,$,O]}),I=l().ui.Button({cls:"light rounded-large border text-smaller padding-right-large o-tooltip",style:{float:"left",padding:"0.2rem","background-color":"#ebebeb"},text:"Lägg till attribut"}),j=l().ui.Element({tagName:"div",style:{display:"inline-block"},components:[I]}),k=l().ui.Element({tagName:"p",style:{"line-height":"1.3rem"},innerHTML:"Filtrera"}),q=l().ui.Element({tagName:"p",style:{"line-height":"1.3rem"},innerHTML:"av följande"}),z=l().ui.Element({tagName:"div",cls:"rounded-large text-smaller o-tooltip",style:{position:"absolute",right:"1rem",padding:"0.3rem",color:`${Se}`,"background-color":`${Be}`},innerHTML:`${Te}`,attributes:{title:`${xe}`}}),A=l().ui.Element({tagName:"div",cls:"flex text-smaller",components:[k,N,q,z]}),W=l().ui.Element({tagName:"div",components:[A,R,C,j]}),M=l().ui.Element({tagName:"p",cls:"text-smaller",innerHTML:"Filtersträng:"}),Q=l().ui.Textarea({placeholderText:"",cls:"text-smaller width-100"}),H=l().ui.Element({tagName:"div",cls:"o-hidden",components:[M,Q]}),_=l().ui.Element({tagName:"div",cls:"o-hidden",components:[w,W,H,x,g,p,y]}),P=l().ui.Element({tagName:"p",cls:"text-smaller",innerHTML:"Tända lager:"}),U=l().ui.Element({tagName:"div",components:[P,B,_]}),D=l().ui.Element({tagName:"ul"}),V=l().ui.Element({tagName:"div",cls:"o-hidden",components:[D]}),s=l().ui.Element({tagName:"div",components:[b,U,V]}),E=l().ui.Button({cls:"icon-smaller small round absolute grey-lightest z-index-top remove-filter",style:{right:"-0.3rem",top:"-0.3rem"},icon:"#ic_delete_24px",ariaLabel:"Ta bort"}),v=l().ui.Button({cls:"icon-smaller small round absolute grey-lightest z-index-top edit-filter",style:{right:"1.5rem",top:"-0.3rem"},icon:"#ic_edit_24px",ariaLabel:"Redigera"}),L=l().ui.Button({cls:"icon-smaller small round absolute grey-lightest z-index-top display-filter",style:{right:"3.3rem",top:"-0.3rem"},icon:"#ic_visibility_24px",ariaLabel:"Tänd lager"})},onAdd(e){t=e.target,n=`${t.getMain().getMapTools().getId()}`,Y=ke(),ee=t.getControlByName("sharemap"),ee&&"saveStateToServer"===ee.options.storeMethod&&ee.addParamsToGetMapState(de,rt),this.addComponents([i]),this.render(),t.getEmbedded()&&!0===ye&&document.getElementsByClassName("o-filteretuna")[0].classList.add("hidden"),Ne&&(ne=function(e={}){const{geoserverUrl:t}=e;return l().ui.Component({async getFtlMap(e){let n=e.get("sourceName");n.includes("/")&&(n=n.split("/wms").shift().split("/wfs").shift().split("/").pop());const l=await(async(e,n)=>{if(!e||!n)return null;try{const l=await fetch(`${t}/rest/layers/${e}:${n}.json`);return l.ok?await l.json():null}catch(e){return null}})(n,e.get("name"));if(!l)return null;const o=await(async e=>{if(!e)return null;try{const t=await fetch(`${e.replace(".json","")}/templates/content.ftl`);return t.ok?await t.text():null}catch(e){return null}})(l.layer.resource.href);return o?(e=>{const t=[],n=(new DOMParser).parseFromString(e,"text/html"),l=n.querySelector(".featureInfoHeader");if(l){const e=l.querySelector(".headerText").innerHTML.split(".")[1];t.push({ftlValue:`Rubrik (${e})`,name:e});const n=l.querySelector(".headerLink");if(n&&n.href.includes("feature.")){const e=n.href.split("feature.")[1].split(".")[0];t.push({ftlValue:`Länk (${e})`,name:e})}}const o=n.querySelector(".featureInfoDescription");if(o){const e=o.querySelector(".descriptionText").innerHTML.split(".")[1];t.push({ftlValue:"Beskrivning",name:e})}return Array.from(n.querySelectorAll(".featureInfoImage img")).forEach((e=>{if(!e.src.includes("feature."))return;const n=e.src.split("feature.")[1].split(".")[0];t.some((e=>e.ftlValue===`Bild-URL (${n})`))||t.push({ftlValue:`Bild-URL (${n})`,name:n})})),Array.from(n.querySelectorAll(".attributeLink")).forEach((e=>{if(!e.href.includes("feature."))return;const n=e.href.split("feature.")[1].split(".")[0];t.push({ftlValue:`Länk (${n})`,name:n})})),Array.from(n.querySelectorAll(".featureInfoAttributeValue")).forEach((e=>{const n=e.querySelector(".attributeText"),l=e.querySelector(".valueText");if(!n||!l)return;const o=n.innerHTML.replace(":",""),r=l.innerHTML.split(".")[1];t.push({ftlValue:o,name:r})})),t})(o):null}})}({geoserverUrl:Ne})),tt(),it(),t.getMap().getLayers().on("add",(async()=>{await at(),it()})),t.getMap().getLayers().on("remove",(async e=>{await at(),it();const t=e.element;t&&(Ke(t.get("name")),Oe())})),be&&t.on("toggleClickInteraction",(e=>{"filter"===e.name&&e.active?lt():ot()}));const o=t.getUrlParams();o[de]&&o[de].filters.length>0&&(le=o[de],le.filters.forEach((e=>{const n=t.getLayer(e.layerName);if(n)if("WMS"===n.get("type")){const l=n.getSource();Je(l,n);const o=Qe(l);"image"===o.WMSType?l.once("imageloadend",(()=>{l.updateParams({layers:e.layerName,CQL_FILTER:e.cqlFilter}),ze(e.layerName,t.getEmbedded())})):"tile"===o.WMSType&&l.once("tileloadend",(()=>{l.updateParams({layers:e.layerName,CQL_FILTER:e.cqlFilter}),ze(e.layerName,t.getEmbedded())})),pe.push(n)}else"WFS"===n.get("type")&&setTimeout((()=>{Ve({layer:n,cqlFilter:e.cqlFilter,ogcFilter:e.ogcFilter}),ze(e.layerName,t.getEmbedded()),pe.push(n)}),Ce)})))},render(){document.getElementById(n).appendChild(se.dom.html(a.render())),document.getElementById(a.getId()).appendChild(se.dom.html(i.render())),document.getElementById(t.getMain().getId()).appendChild(se.dom.html(d.render())),document.getElementById(d.getId()).appendChild(se.dom.html(s.render())),document.getElementById(g.getId()).addEventListener("click",(()=>function(){let e="",t="";const n=function(){const e=Array.from(document.getElementsByClassName("attributeRow")),t=document.getElementById(N.getId()).value,n=[];return e.forEach((e=>{const t=e.querySelector(`#${S.getId()}`).value,l=e.querySelector(`#${T.getId()}`).value,o=e.querySelector("input").value;""!==o&&n.push({att:t,opr:l,val:o})})),{filters:n,logic:t}},l=function({filters:e,logic:n}){const l=n.charAt(0)+n.slice(1).toLowerCase(),o=e.reduce(((e,t)=>{let n=`<${Ye(t.opr)}`;if(" like "===t.opr){n+=' wildCard="*" singleChar="." escape="!">';const e=t;e.val=e.val.replaceAll("%","*")}else n+=">";return`${e}${n}<PropertyName>${t.att}</PropertyName><Literal>${t.val}</Literal></${Ye(t.opr)}>`}),"");return t=`<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:${l}>${o}</ogc:${l}></ogc:Filter>`,t};if("simple"===ie){const{filters:o,logic:r}=n();e=o.map((e=>`${e.att}${e.opr}'${e.val}'`)).join(` ${r} `),"WFS"===X.get("type")&&(t=l({filters:o,logic:r})),document.getElementById(Q.getId()).value=e}else"advanced"===ie&&(e=document.getElementById(Q.getId()).value,"WFS"===X.get("type")&&(We(e),t=l(n())));if("WMS"===X.get("type")){const t=X.getSource();t.setUrl(o(t)),Je(t,X),t.updateParams({layers:X.get("id"),CQL_FILTER:e})}else"WFS"===X.get("type")&&Ve({layer:X,cqlFilter:e,ogcFilter:t});""!==qe(X)&&(pe.push(X),Ue(X.get("name")),Oe(),Ke(X.get("name")),le.filters.push({title:X.get("title"),layerName:X.get("name"),cqlFilter:e,ogcFilter:t}))}())),document.getElementById(y.getId()).addEventListener("click",(()=>Ze())),document.getElementById(p.getId()).addEventListener("click",(()=>function(){document.getElementById(Q.getId()).value="";for(let e=0;e<pe.length;e+=1){const t=pe[e];if("WMS"===t.get("type")){const e=t.getSource();Ge(t)||De(e,!0),e.updateParams({layers:t.get("id"),CQL_FILTER:void 0})}else"WFS"===t.get("type")&&Ve({layer:t});pe.splice(e,1),e-=1}!function(){const e=document.getElementById(B.getId());Array.from(e.options).forEach((t=>{e.options[t.index].text=t.text.replace(Ee,""),e.options[t.index].style=""}))}(),Ae(),Ke(),Oe()}())),document.getElementById(I.getId()).addEventListener("click",(()=>je())),document.getElementById(c.getId()).addEventListener("click",(()=>nt("simple"))),document.getElementById(m.getId()).addEventListener("click",(()=>nt("advanced"))),document.getElementById(u.getId()).addEventListener("click",(()=>nt("myfilter"))),window.addEventListener("resize",(()=>Fe())),this.dispatch("render")}})}})(),Origofilteretuna=t.default})();